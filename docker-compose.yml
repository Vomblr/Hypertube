version: '3'

services:
        db:
            image: postgres
            environment:
                - POSTGRES_DB=hypertube
                - POSTGRES_USER=mcomet
                - POSTGRES_PASSWORD=pass_mcomet
            restart: always
            container_name: db

        web:
            build: .
            command: python manage.py runserver 0.0.0.0:8000
            volumes:
                - .:/code
            ports:
                -  "8000:8000"
            depends_on:
                - db
            restart: always
            container_name: web

        phppgadmin:
            container_name: phppgadmin
            restart: always
            image: dockage/phppgadmin:latest
            ports:
                - "8081:80"
            environment:
                - PHP_PG_ADMIN_SERVER_DESC=PostgreSQL
                - PHP_PG_ADMIN_SERVER_HOST=
                - PHP_PG_ADMIN_SERVER_PORT=5432
                - PHP_PG_ADMIN_SERVER_SSL_MODE=allow
                - PHP_PG_ADMIN_SERVER_DEFAULT_DB=template1
                - PHP_PG_ADMIN_SERVER_PG_DUMP_PATH=/usr/bin/pg_dump
                - PHP_PG_ADMIN_SERVER_PG_DUMPALL_PATH=/usr/bin/pg_dumpall
                - PHP_PG_ADMIN_DEFAULT_LANG=auto
                - PHP_PG_ADMIN_AUTO_COMPLETE=default on
                - PHP_PG_ADMIN_EXTRA_LOGIN_SECURITY=false
                - PHP_PG_ADMIN_OWNED_ONLY=false
                - PHP_PG_ADMIN_SHOW_COMMENTS=true
                - PHP_PG_ADMIN_SHOW_ADVANCED=false
                - PHP_PG_ADMIN_SHOW_SYSTEM=false
                - PHP_PG_ADMIN_MIN_PASSWORD_LENGTH=1
                - PHP_PG_ADMIN_LEFT_WIDTH=200
                - PHP_PG_ADMIN_THEME=default
                - PHP_PG_ADMIN_SHOW_OIDS=false
                - PHP_PG_ADMIN_MAX_ROWS=30
                - PHP_PG_ADMIN_MAX_CHARS=50
                - PHP_PG_ADMIN_USE_XHTML_STRICT=false
                - PHP_PG_ADMIN_HELP_BASE=http://www.postgresql.org/docs/%s/interactive/
                - PHP_PG_ADMIN_AJAX_REFRESH=3

        jenkins:
            container_name: jenkins
            restart: always
            ports:
                - '8080:8080'
                - '50000:50000'
            volumes:
                - '/var/run/docker.sock:/var/run/docker.sock'
                - '/usr/bin/docker:/usr/bin/docker'
                - '/usr/local/bin/docker-compose:/usr/local/bin/docker-compose'
                - '/root/jenkins_home:/var/jenkins_home'
                - '/root/backups:/var/backups'
            image: 'jenkins/jenkins:lts'
            user: root
            environment:
                - TZ="Europe/Moscow"

        apache:
            container_name: apache-template
            restart: always
            ports:
                - '1111:80'
            volumes:
                - './vidoe_template:/usr/local/apache2/htdocs/'
            image: 'httpd:2.4'
